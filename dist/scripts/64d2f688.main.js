"use strict";var margin={top:180,right:0,bottom:10,left:180},width=500,height=500,svg=d3.select("#chart").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).style("margin-left",-margin.left+"px").append("g").attr("transform","translate("+margin.left+","+margin.top+")");d3.json("/data.json",function(a){function b(a){d3.select(this).selectAll(".cell").data(a.filter(function(a){return a.z})).enter().append("rect").attr("class","cell").attr("x",function(a){return g(a.x)}).attr("width",g.rangeBand()).attr("height",g.rangeBand()).attr("title",function(a){return a.z+" people"}).style("fill-opacity",function(a){return h(a.z)}).style("fill",function(a){return k[a.x].group===k[a.y].group?i(k[a.x].group):null}).on("mouseover",c).on("mouseout",d)}function c(a){d3.selectAll(".row text").classed("active",function(b,c){return c===a.y}),d3.selectAll(".column text").classed("active",function(b,c){return c===a.x})}function d(){d3.selectAll("text").classed("active",!1)}function e(a){g.domain(m[a]);var b=svg.transition().duration(2500);b.selectAll(".row").delay(function(a,b){return 4*g(b)}).attr("transform",function(a,b){return"translate(0,"+g(b)+")"}).selectAll(".cell").delay(function(a){return 4*g(a.x)}).attr("x",function(a){return g(a.x)}),b.selectAll(".column").delay(function(a,b){return 4*g(b)}).attr("transform",function(a,b){return"translate("+g(b)+")rotate(-90)"})}var f=d3.extent(a.links,function(a){return a.value}),g=d3.scale.ordinal().rangeBands([0,width]),h=d3.scale.linear().domain(f).clamp(!0),i=d3.scale.category10().domain(d3.range(10)),j=[],k=a.nodes,l=k.length;k.forEach(function(a,b){a.index=b,a.count=0,j[b]=d3.range(l).map(function(a){return{x:a,y:b,z:0}})}),a.links.forEach(function(a){j[a.source][a.target].z=a.value,j[a.target][a.source].z=a.value});var m={name:d3.range(l).sort(function(a,b){return d3.ascending(k[a].name,k[b].name)}),count:d3.range(l).sort(function(a,b){return k[b].count-k[a].count}),group:d3.range(l).sort(function(a,b){return k[b].group-k[a].group})};g.domain(m.count),svg.append("rect").attr("class","background").attr("width",width).attr("height",height);var b=svg.selectAll(".row").data(j).enter().append("g").attr("class","row").attr("transform",function(a,b){return"translate(0,"+g(b)+")"}).each(b);b.append("line").attr("x2",width),b.append("text").attr("x",-6).attr("y",g.rangeBand()/2).attr("dy",".32em").attr("text-anchor","end").text(function(a,b){return k[b].name});var n=svg.selectAll(".column").data(j).enter().append("g").attr("class","column").attr("transform",function(a,b){return"translate("+g(b)+")rotate(-90)"});n.append("line").attr("x1",-width),n.append("text").attr("x",6).attr("y",g.rangeBand()/2).attr("dy",".32em").attr("text-anchor","start").text(function(a,b){return k[b].name}),d3.select("#order").on("change",function(){clearTimeout(o),e(this.value)});var o=setTimeout(function(){e("count"),d3.select("#order").property("selectedIndex",2).node().focus()},5e3)});